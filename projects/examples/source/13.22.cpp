//////////////////////////////////////////////////////////////////////////////////////////////

// support : sudo systemctl start postgresql
//
// support : sudo -u postgres psql
//
// support : ALTER USER postgres PASSWORD '1234';

//////////////////////////////////////////////////////////////////////////////////////////////

#include <cassert>

//////////////////////////////////////////////////////////////////////////////////////////////

#include <pqxx/pqxx>

//////////////////////////////////////////////////////////////////////////////////////////////

int main()
{
    pqxx::connection connection("postgresql://postgres:1234@127.0.0.1:5432/postgres");

//  ------------------------------------------------------------------------------------------

    pqxx::work work_1(connection);

//  ------------------------------------------------------------------------------------------

    work_1.exec("CREATE TABLE Entities (x INTEGER UNIQUE, string VARCHAR(5) UNIQUE)");

//  ------------------------------------------------------------------------------------------

    work_1.exec("INSERT INTO Entities (x, string) VALUES (1, 'aaaaa')");

    work_1.exec("INSERT INTO Entities (x, string) VALUES (2, 'bbbbb')");

//  ------------------------------------------------------------------------------------------

    work_1.commit();

//  ------------------------------------------------------------------------------------------

    pqxx::work work_2(connection);

//  ------------------------------------------------------------------------------------------

    assert(work_2.query_value < int > ("SELECT x FROM Entities WHERE string = 'aaaaa'") == 1);

//  ------------------------------------------------------------------------------------------

    work_2.exec("DROP TABLE Entities");

//  ------------------------------------------------------------------------------------------

    work_2.commit();
}

//////////////////////////////////////////////////////////////////////////////////////////////